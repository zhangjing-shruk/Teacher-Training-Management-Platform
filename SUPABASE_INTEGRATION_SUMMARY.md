# AIæ•™å¸ˆåŸ¹è®­å¹³å° - Supabase é›†æˆæ€»ç»“

## ğŸ¯ é›†æˆæ¦‚è¿°

æœ¬æ–‡æ¡£æ€»ç»“äº† AIæ•™å¸ˆåŸ¹è®­å¹³å°ä¸ Supabase æ•°æ®åº“çš„å®Œæ•´é›†æˆè¿‡ç¨‹ã€‚è¯¥é›†æˆæ”¯æŒå¤šç”¨æˆ·ç³»ç»Ÿï¼ˆæ•™å¸ˆå’Œç®¡ç†è€…è§’è‰²ï¼‰ï¼Œæä¾›äº†å®Œæ•´çš„è®¤è¯ã€æ•°æ®ç®¡ç†å’Œ API æœåŠ¡ã€‚

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. æ•°æ®åº“è®¾è®¡ä¸å»ºè¡¨
- **æ–‡ä»¶**: `supabase_schema.sql`
- **å†…å®¹**:
  - ç”¨æˆ·è¡¨ (users) - æ”¯æŒæ•™å¸ˆå’Œç®¡ç†è€…è§’è‰²
  - åŸ¹è®­èµ„æ–™è¡¨ (training_materials) - æ”¯æŒå¤šç§èµ„æ–™ç±»å‹
  - ç»ƒä¹ ä¼šè¯è¡¨ (practice_sessions) - è®°å½•ç”¨æˆ·ç»ƒä¹ æ´»åŠ¨
  - åé¦ˆè¡¨ (feedback) - å­˜å‚¨ç”¨æˆ·åé¦ˆå’Œè¯„åˆ†
  - å­¦ä¹ è¿›åº¦è¡¨ (learning_progress) - è·Ÿè¸ªå­¦ä¹ çŠ¶æ€
  - å®Œæ•´çš„ç´¢å¼•ã€è§¦å‘å™¨å’Œ RLS å®‰å…¨ç­–ç•¥

### 2. åç«¯é›†æˆ

#### ç¯å¢ƒé…ç½®
- **æ–‡ä»¶**: `backend/.env.example`, `backend/.env`
- **é…ç½®é¡¹**:
  - `SUPABASE_URL`: Supabase é¡¹ç›® URL
  - `SUPABASE_ANON_KEY`: åŒ¿åè®¿é—®å¯†é’¥
  - `SUPABASE_SERVICE_ROLE_KEY`: æœåŠ¡è§’è‰²å¯†é’¥

#### ä¾èµ–ç®¡ç†
- **æ–‡ä»¶**: `backend/requirements.txt`
- **æ–°å¢ä¾èµ–**:
  - `supabase==2.3.4`
  - `postgrest==0.13.2`

#### æ ¸å¿ƒæœåŠ¡
- **æ–‡ä»¶**: `backend/app/core/supabase.py`
  - Supabase å®¢æˆ·ç«¯é…ç½®
  - æ•°æ®åº“å¸¸é‡å®šä¹‰

#### ä¸šåŠ¡æœåŠ¡
1. **ç”¨æˆ·æœåŠ¡** (`backend/app/services/supabase_user_service.py`)
   - ç”¨æˆ·åˆ›å»ºã€è®¤è¯ã€æŸ¥è¯¢
   - è§’è‰²ç®¡ç†ï¼ˆæ•™å¸ˆ/ç®¡ç†è€…ï¼‰
   - ç”¨æˆ·çŠ¶æ€ç®¡ç†

2. **åŸ¹è®­æœåŠ¡** (`backend/app/services/supabase_training_service.py`)
   - åŸ¹è®­èµ„æ–™ç®¡ç†
   - å­¦ä¹ è¿›åº¦è·Ÿè¸ª
   - ä¸‹è½½ç»Ÿè®¡

3. **ç»ƒä¹ æœåŠ¡** (`backend/app/services/supabase_practice_service.py`)
   - ç»ƒä¹ ä¼šè¯ç®¡ç†
   - åé¦ˆç³»ç»Ÿ
   - ç»Ÿè®¡åˆ†æ

#### API è·¯ç”±
1. **è®¤è¯ API** (`backend/app/api/supabase_auth.py`)
   - ç”¨æˆ·æ³¨å†Œã€ç™»å½•ã€ç™»å‡º
   - ç”¨æˆ·èµ„æ–™ç®¡ç†
   - ç®¡ç†å‘˜åŠŸèƒ½

2. **åŸ¹è®­ API** (`backend/app/api/supabase_training.py`)
   - åŸ¹è®­èµ„æ–™ CRUD
   - å­¦ä¹ è¿›åº¦ç®¡ç†
   - ç»Ÿè®¡æŸ¥è¯¢

3. **ç»ƒä¹  API** (`backend/app/api/supabase_practice.py`)
   - ç»ƒä¹ ä¼šè¯ç®¡ç†
   - åé¦ˆç³»ç»Ÿ
   - æ•°æ®ç»Ÿè®¡

#### ä¸»åº”ç”¨é›†æˆ
- **æ–‡ä»¶**: `backend/app/main.py`
- **æ›´æ–°**: æ³¨å†Œäº†æ‰€æœ‰ Supabase API è·¯ç”±

### 3. å‰ç«¯é›†æˆ

#### ä¾èµ–ç®¡ç†
- **æ–‡ä»¶**: `frontend/package.json`
- **æ–°å¢ä¾èµ–**: `@supabase/supabase-js@^2.39.3`

#### ç¯å¢ƒé…ç½®
- **æ–‡ä»¶**: `frontend/.env.example`, `frontend/.env`
- **é…ç½®é¡¹**:
  - `VITE_SUPABASE_URL`: Supabase é¡¹ç›® URL
  - `VITE_SUPABASE_ANON_KEY`: åŒ¿åè®¿é—®å¯†é’¥
  - `VITE_API_BASE_URL`: åç«¯ API åœ°å€

#### æ ¸å¿ƒé…ç½®
- **æ–‡ä»¶**: `frontend/src/lib/supabase.ts`
  - Supabase å®¢æˆ·ç«¯é…ç½®
  - ç±»å‹å®šä¹‰
  - å¸¸é‡å®šä¹‰

#### è®¤è¯æœåŠ¡
- **æ–‡ä»¶**: `frontend/src/stores/supabaseAuth.ts`
  - åŸºäº Pinia çš„è®¤è¯çŠ¶æ€ç®¡ç†
  - ç”¨æˆ·æ³¨å†Œã€ç™»å½•ã€ç™»å‡º
  - è§’è‰²æƒé™ç®¡ç†

#### æ•°æ®æœåŠ¡
- **æ–‡ä»¶**: `frontend/src/services/supabaseService.ts`
  - åŸ¹è®­èµ„æ–™æœåŠ¡
  - å­¦ä¹ è¿›åº¦æœåŠ¡
  - ç»ƒä¹ ä¼šè¯æœåŠ¡
  - åé¦ˆæœåŠ¡
  - ç®¡ç†å‘˜ç»Ÿè®¡æœåŠ¡

#### ä¸»åº”ç”¨é›†æˆ
- **æ–‡ä»¶**: `frontend/src/main.ts`
- **æ›´æ–°**: åˆå§‹åŒ– Supabase è®¤è¯

### 4. æµ‹è¯•å·¥å…·

#### å¯¼å…¥æµ‹è¯•
- **æ–‡ä»¶**: `test_imports.py`
- **åŠŸèƒ½**: éªŒè¯ Python æ¨¡å—å¯¼å…¥

#### è¿æ¥æµ‹è¯•
- **æ–‡ä»¶**: `test_supabase_connection.py`
- **åŠŸèƒ½**: å®Œæ•´çš„ Supabase åŠŸèƒ½æµ‹è¯•

## ğŸ”§ ç³»ç»Ÿç‰¹æ€§

### å¤šç”¨æˆ·æ”¯æŒ
- **æ•™å¸ˆè§’è‰²**: è®¿é—®åŸ¹è®­èµ„æ–™ã€å‚ä¸ç»ƒä¹ ã€æŸ¥çœ‹ä¸ªäººè¿›åº¦
- **ç®¡ç†è€…è§’è‰²**: ç®¡ç†åŸ¹è®­èµ„æ–™ã€æŸ¥çœ‹æ‰€æœ‰ç”¨æˆ·æ•°æ®ã€ç³»ç»Ÿç»Ÿè®¡

### å®‰å…¨ç‰¹æ€§
- **è¡Œçº§å®‰å…¨ (RLS)**: ç¡®ä¿ç”¨æˆ·åªèƒ½è®¿é—®è‡ªå·±çš„æ•°æ®
- **è§’è‰²æƒé™**: åŸºäºç”¨æˆ·è§’è‰²çš„è®¿é—®æ§åˆ¶
- **è®¤è¯é›†æˆ**: å®Œæ•´çš„ç”¨æˆ·è®¤è¯æµç¨‹

### æ•°æ®å®Œæ•´æ€§
- **å¤–é”®çº¦æŸ**: ç¡®ä¿æ•°æ®å…³ç³»å®Œæ•´æ€§
- **è§¦å‘å™¨**: è‡ªåŠ¨æ›´æ–°æ—¶é—´æˆ³
- **ç´¢å¼•ä¼˜åŒ–**: æé«˜æŸ¥è¯¢æ€§èƒ½

## ğŸ“‹ å¾…å®Œæˆä»»åŠ¡

### 1. ä¾èµ–å®‰è£…
- åç«¯ Supabase Python å®¢æˆ·ç«¯å®‰è£…æ­£åœ¨è¿›è¡Œä¸­
- å‰ç«¯ä¾èµ–å·²æˆåŠŸå®‰è£…

### 2. æ•°æ®åº“åˆå§‹åŒ–
- åœ¨ Supabase æ§åˆ¶å°æ‰§è¡Œ `supabase_schema.sql`
- é…ç½®æ­£ç¡®çš„ç¯å¢ƒå˜é‡

### 3. æµ‹è¯•éªŒè¯
- è¿è¡Œè¿æ¥æµ‹è¯•è„šæœ¬
- éªŒè¯ API ç«¯ç‚¹åŠŸèƒ½
- æµ‹è¯•å‰ç«¯è®¤è¯æµç¨‹

### 4. éƒ¨ç½²é…ç½®
- é…ç½®ç”Ÿäº§ç¯å¢ƒå˜é‡
- è®¾ç½® Supabase é¡¹ç›®
- é…ç½®åŸŸåå’Œ CORS

## ğŸš€ ä¸‹ä¸€æ­¥æ“ä½œ

1. **å®Œæˆä¾èµ–å®‰è£…**:
   ```bash
   cd backend
   pip install supabase==2.3.4 postgrest==0.13.2
   ```

2. **é…ç½® Supabase é¡¹ç›®**:
   - åœ¨ Supabase æ§åˆ¶å°åˆ›å»ºæ–°é¡¹ç›®
   - æ‰§è¡Œ `supabase_schema.sql` å»ºè¡¨è„šæœ¬
   - æ›´æ–°ç¯å¢ƒå˜é‡ä¸­çš„å®é™…è¿æ¥ä¿¡æ¯

3. **è¿è¡Œæµ‹è¯•**:
   ```bash
   python3 test_imports.py
   python3 test_supabase_connection.py
   ```

4. **å¯åŠ¨æœåŠ¡**:
   ```bash
   # åç«¯
   cd backend
   uvicorn app.main:app --reload
   
   # å‰ç«¯
   cd frontend
   npm run dev
   ```

## ğŸ“ æ³¨æ„äº‹é¡¹

- ç¡®ä¿ Supabase é¡¹ç›®é…ç½®æ­£ç¡®
- æ£€æŸ¥ç¯å¢ƒå˜é‡è®¾ç½®
- éªŒè¯ç½‘ç»œè¿æ¥å’Œé˜²ç«å¢™è®¾ç½®
- å…³æ³¨ RLS ç­–ç•¥çš„æ­£ç¡®é…ç½®

## ğŸ‰ æ€»ç»“

Supabase é›†æˆå·²åŸºæœ¬å®Œæˆï¼ŒåŒ…æ‹¬ï¼š
- âœ… å®Œæ•´çš„æ•°æ®åº“è®¾è®¡
- âœ… åç«¯æœåŠ¡å’Œ API
- âœ… å‰ç«¯å®¢æˆ·ç«¯å’Œè®¤è¯
- âœ… å¤šç”¨æˆ·è§’è‰²æ”¯æŒ
- âœ… å®‰å…¨ç­–ç•¥é…ç½®

ç³»ç»Ÿç°åœ¨å…·å¤‡äº†å®Œæ•´çš„å¤šç”¨æˆ·æ•™å¸ˆåŸ¹è®­å¹³å°åŠŸèƒ½ï¼Œæ”¯æŒç”¨æˆ·ç®¡ç†ã€åŸ¹è®­èµ„æ–™ç®¡ç†ã€ç»ƒä¹ ä¼šè¯å’Œåé¦ˆç³»ç»Ÿã€‚