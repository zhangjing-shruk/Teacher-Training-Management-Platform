<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¯¾ç¨‹ä¸»é¢˜åŒæ­¥æµ‹è¯•æ¼”ç¤º</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        .panel {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .panel h2 {
            margin-top: 0;
            color: #333;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
        }
        .admin-panel h2 {
            border-bottom-color: #28a745;
        }
        .teacher-panel h2 {
            border-bottom-color: #007bff;
        }
        .topic-list {
            margin: 15px 0;
            padding: 0;
            list-style: none;
        }
        .topic-item {
            background: #f8f9fa;
            margin: 5px 0;
            padding: 10px;
            border-radius: 4px;
            border-left: 4px solid #007bff;
        }
        .admin-panel .topic-item {
            border-left-color: #28a745;
        }
        .controls {
            margin: 15px 0;
        }
        .btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        .btn:hover {
            background: #0056b3;
        }
        .btn-success {
            background: #28a745;
        }
        .btn-success:hover {
            background: #1e7e34;
        }
        .btn-danger {
            background: #dc3545;
        }
        .btn-danger:hover {
            background: #c82333;
        }
        .input-group {
            display: flex;
            margin: 10px 0;
        }
        .input-group input {
            flex: 1;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px 0 0 4px;
        }
        .input-group button {
            border-radius: 0 4px 4px 0;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-weight: bold;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        .instructions {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .instructions h1 {
            color: #333;
            margin-top: 0;
        }
        .step {
            margin: 10px 0;
            padding: 10px;
            background: #f8f9fa;
            border-left: 4px solid #007bff;
            border-radius: 0 4px 4px 0;
        }
        .log {
            background: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px;
            margin: 10px 0;
            max-height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="instructions">
        <h1>ğŸ”„ è¯¾ç¨‹ä¸»é¢˜åŒæ­¥åŠŸèƒ½æµ‹è¯•æ¼”ç¤º</h1>
        <p>æ­¤é¡µé¢æ¼”ç¤ºç®¡ç†å‘˜ç«¯è¯¾ç¨‹ä¸»é¢˜ç®¡ç†ä¸æ•™å¸ˆç«¯è¯•è®²ç»ƒä¹ é¡µé¢çš„å®æ—¶åŒæ­¥åŠŸèƒ½ã€‚</p>
        
        <div class="step">
            <strong>æ­¥éª¤ 1:</strong> ç‚¹å‡»ä¸‹æ–¹"ç™»å½•"æŒ‰é’®è·å–è®¿é—®æƒé™
        </div>
        <div class="step">
            <strong>æ­¥éª¤ 2:</strong> åœ¨ç®¡ç†å‘˜ç«¯æ·»åŠ ã€ä¿®æ”¹æˆ–åˆ é™¤è¯¾ç¨‹ä¸»é¢˜
        </div>
        <div class="step">
            <strong>æ­¥éª¤ 3:</strong> ç‚¹å‡»"åˆ·æ–°æ•™å¸ˆç«¯æ•°æ®"æŸ¥çœ‹åŒæ­¥æ•ˆæœ
        </div>
        <div class="step">
            <strong>æ­¥éª¤ 4:</strong> éªŒè¯ä¸¤ç«¯æ•°æ®æ˜¯å¦ä¸€è‡´
        </div>
    </div>

    <div class="container">
        <!-- ç®¡ç†å‘˜ç«¯é¢æ¿ -->
        <div class="panel admin-panel">
            <h2>ğŸ› ï¸ ç®¡ç†å‘˜ç«¯ - è¯¾ç¨‹ä¸»é¢˜ç®¡ç†</h2>
            
            <div class="controls">
                <button class="btn btn-success" onclick="login()">ç™»å½•</button>
                <button class="btn" onclick="loadAdminTopics()">åˆ·æ–°æ•°æ®</button>
            </div>

            <div class="input-group">
                <input type="text" id="newTopic" placeholder="è¾“å…¥æ–°çš„è¯¾ç¨‹ä¸»é¢˜..." onkeypress="handleEnter(event)">
                <button class="btn btn-success" onclick="addTopic()">æ·»åŠ ä¸»é¢˜</button>
            </div>

            <div id="adminStatus" class="status info">è¯·å…ˆç™»å½•ä»¥è·å–è®¿é—®æƒé™</div>

            <h3>å½“å‰è¯¾ç¨‹ä¸»é¢˜åˆ—è¡¨:</h3>
            <ul id="adminTopics" class="topic-list">
                <li class="topic-item">ç­‰å¾…åŠ è½½...</li>
            </ul>

            <div class="controls">
                <button class="btn btn-success" onclick="saveTopics()">ä¿å­˜æ‰€æœ‰æ›´æ”¹</button>
                <button class="btn btn-danger" onclick="resetTopics()">é‡ç½®ä¸ºé»˜è®¤</button>
            </div>

            <div class="log" id="adminLog"></div>
        </div>

        <!-- æ•™å¸ˆç«¯é¢æ¿ -->
        <div class="panel teacher-panel">
            <h2>ğŸ‘¨â€ğŸ« æ•™å¸ˆç«¯ - è¯•è®²ç»ƒä¹ é€‰æ‹©</h2>
            
            <div class="controls">
                <button class="btn" onclick="loadTeacherTopics()">åˆ·æ–°æ•™å¸ˆç«¯æ•°æ®</button>
            </div>

            <div id="teacherStatus" class="status info">ç­‰å¾…åŠ è½½æ•™å¸ˆç«¯æ•°æ®</div>

            <h3>è¯·é€‰æ‹©è¯¾ç¨‹ä¸»é¢˜:</h3>
            <select id="teacherTopicSelect" style="width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ddd; border-radius: 4px;">
                <option value="">è¯·é€‰æ‹©è¯¾ç¨‹ä¸»é¢˜</option>
            </select>

            <ul id="teacherTopics" class="topic-list">
                <li class="topic-item">ç­‰å¾…åŠ è½½...</li>
            </ul>

            <div class="log" id="teacherLog"></div>
        </div>
    </div>

    <script>
        const API_BASE_URL = 'http://localhost:8000';
        let authToken = null;
        let adminTopics = [];

        function log(message, target = 'admin') {
            const logElement = document.getElementById(target + 'Log');
            const timestamp = new Date().toLocaleTimeString();
            logElement.innerHTML += `[${timestamp}] ${message}\n`;
            logElement.scrollTop = logElement.scrollHeight;
        }

        function setStatus(message, type = 'info', target = 'admin') {
            const statusElement = document.getElementById(target + 'Status');
            statusElement.className = `status ${type}`;
            statusElement.textContent = message;
        }

        async function login() {
            try {
                log('ğŸ” æ­£åœ¨ç™»å½•...');
                const response = await fetch(`${API_BASE_URL}/api/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        email: 'zhangjing32@51talk.com',
                        password: 'admin123456'
                    })
                });

                if (response.ok) {
                    const data = await response.json();
                    authToken = data.access_token;
                    log('âœ… ç™»å½•æˆåŠŸ');
                    setStatus('ç™»å½•æˆåŠŸï¼Œå¯ä»¥è¿›è¡Œè¯¾ç¨‹ä¸»é¢˜ç®¡ç†', 'success');
                    await loadAdminTopics();
                } else {
                    log('âŒ ç™»å½•å¤±è´¥: ' + response.status);
                    setStatus('ç™»å½•å¤±è´¥ï¼Œè¯·æ£€æŸ¥è´¦æˆ·ä¿¡æ¯', 'error');
                }
            } catch (error) {
                log('âŒ ç™»å½•é”™è¯¯: ' + error.message);
                setStatus('ç™»å½•é”™è¯¯: ' + error.message, 'error');
            }
        }

        async function loadAdminTopics() {
            if (!authToken) {
                setStatus('è¯·å…ˆç™»å½•', 'error');
                return;
            }

            try {
                log('ğŸ“¥ æ­£åœ¨åŠ è½½ç®¡ç†å‘˜ç«¯è¯¾ç¨‹ä¸»é¢˜...');
                const response = await fetch(`${API_BASE_URL}/api/manager/course-topics`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });

                if (response.ok) {
                    adminTopics = await response.json();
                    log(`âœ… æˆåŠŸåŠ è½½ ${adminTopics.length} ä¸ªè¯¾ç¨‹ä¸»é¢˜`);
                    setStatus(`å·²åŠ è½½ ${adminTopics.length} ä¸ªè¯¾ç¨‹ä¸»é¢˜`, 'success');
                    renderAdminTopics();
                } else {
                    log('âŒ åŠ è½½å¤±è´¥: ' + response.status);
                    setStatus('åŠ è½½è¯¾ç¨‹ä¸»é¢˜å¤±è´¥', 'error');
                }
            } catch (error) {
                log('âŒ åŠ è½½é”™è¯¯: ' + error.message);
                setStatus('åŠ è½½é”™è¯¯: ' + error.message, 'error');
            }
        }

        async function loadTeacherTopics() {
            try {
                log('ğŸ“¥ æ­£åœ¨åŠ è½½æ•™å¸ˆç«¯è¯¾ç¨‹ä¸»é¢˜...', 'teacher');
                // æ¨¡æ‹Ÿæ•™å¸ˆç«¯çš„APIè°ƒç”¨ï¼ˆä½¿ç”¨ç›¸åŒçš„APIä½†ä¸åŒçš„tokenè·å–æ–¹å¼ï¼‰
                const response = await fetch(`${API_BASE_URL}/api/manager/course-topics`, {
                    headers: {
                        'Authorization': `Bearer ${authToken || localStorage.getItem('access_token')}`
                    }
                });

                if (response.ok) {
                    const teacherTopics = await response.json();
                    log(`âœ… æ•™å¸ˆç«¯æˆåŠŸåŠ è½½ ${teacherTopics.length} ä¸ªè¯¾ç¨‹ä¸»é¢˜`, 'teacher');
                    setStatus(`æ•™å¸ˆç«¯å·²åŠ è½½ ${teacherTopics.length} ä¸ªè¯¾ç¨‹ä¸»é¢˜`, 'success', 'teacher');
                    renderTeacherTopics(teacherTopics);
                } else {
                    log('âŒ æ•™å¸ˆç«¯åŠ è½½å¤±è´¥: ' + response.status, 'teacher');
                    setStatus('æ•™å¸ˆç«¯åŠ è½½è¯¾ç¨‹ä¸»é¢˜å¤±è´¥', 'error', 'teacher');
                }
            } catch (error) {
                log('âŒ æ•™å¸ˆç«¯åŠ è½½é”™è¯¯: ' + error.message, 'teacher');
                setStatus('æ•™å¸ˆç«¯åŠ è½½é”™è¯¯: ' + error.message, 'error', 'teacher');
            }
        }

        function renderAdminTopics() {
            const topicsList = document.getElementById('adminTopics');
            topicsList.innerHTML = '';
            
            adminTopics.forEach((topic, index) => {
                const li = document.createElement('li');
                li.className = 'topic-item';
                li.innerHTML = `
                    <span>${topic}</span>
                    <button class="btn btn-danger" style="float: right; padding: 5px 10px; font-size: 12px;" onclick="deleteTopic(${index})">åˆ é™¤</button>
                `;
                topicsList.appendChild(li);
            });
        }

        function renderTeacherTopics(topics) {
            const topicsList = document.getElementById('teacherTopics');
            const topicsSelect = document.getElementById('teacherTopicSelect');
            
            // æ›´æ–°åˆ—è¡¨
            topicsList.innerHTML = '';
            topics.forEach(topic => {
                const li = document.createElement('li');
                li.className = 'topic-item';
                li.textContent = topic;
                topicsList.appendChild(li);
            });

            // æ›´æ–°ä¸‹æ‹‰é€‰æ‹©
            topicsSelect.innerHTML = '<option value="">è¯·é€‰æ‹©è¯¾ç¨‹ä¸»é¢˜</option>';
            topics.forEach(topic => {
                const option = document.createElement('option');
                option.value = topic;
                option.textContent = topic;
                topicsSelect.appendChild(option);
            });
        }

        function addTopic() {
            const input = document.getElementById('newTopic');
            const topic = input.value.trim();
            
            if (topic && !adminTopics.includes(topic)) {
                adminTopics.push(topic);
                input.value = '';
                log(`â• æ·»åŠ ä¸»é¢˜: ${topic}`);
                renderAdminTopics();
                setStatus(`å·²æ·»åŠ ä¸»é¢˜: ${topic}`, 'success');
            } else if (adminTopics.includes(topic)) {
                setStatus('ä¸»é¢˜å·²å­˜åœ¨', 'error');
            } else {
                setStatus('è¯·è¾“å…¥æœ‰æ•ˆçš„ä¸»é¢˜åç§°', 'error');
            }
        }

        function deleteTopic(index) {
            const topic = adminTopics[index];
            if (confirm(`ç¡®å®šè¦åˆ é™¤ä¸»é¢˜"${topic}"å—ï¼Ÿ`)) {
                adminTopics.splice(index, 1);
                log(`ğŸ—‘ï¸ åˆ é™¤ä¸»é¢˜: ${topic}`);
                renderAdminTopics();
                setStatus(`å·²åˆ é™¤ä¸»é¢˜: ${topic}`, 'success');
            }
        }

        async function saveTopics() {
            if (!authToken) {
                setStatus('è¯·å…ˆç™»å½•', 'error');
                return;
            }

            try {
                log('ğŸ’¾ æ­£åœ¨ä¿å­˜è¯¾ç¨‹ä¸»é¢˜åˆ°æœåŠ¡å™¨...');
                const response = await fetch(`${API_BASE_URL}/api/manager/course-topics/batch`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({ topics: adminTopics })
                });

                if (response.ok) {
                    log('âœ… è¯¾ç¨‹ä¸»é¢˜ä¿å­˜æˆåŠŸ');
                    setStatus('è¯¾ç¨‹ä¸»é¢˜å·²ä¿å­˜åˆ°æœåŠ¡å™¨', 'success');
                    // è‡ªåŠ¨åˆ·æ–°æ•™å¸ˆç«¯æ•°æ®ä»¥éªŒè¯åŒæ­¥
                    setTimeout(() => {
                        loadTeacherTopics();
                    }, 1000);
                } else {
                    log('âŒ ä¿å­˜å¤±è´¥: ' + response.status);
                    setStatus('ä¿å­˜å¤±è´¥ï¼Œè¯·é‡è¯•', 'error');
                }
            } catch (error) {
                log('âŒ ä¿å­˜é”™è¯¯: ' + error.message);
                setStatus('ä¿å­˜é”™è¯¯: ' + error.message, 'error');
            }
        }

        function resetTopics() {
            if (confirm('ç¡®å®šè¦é‡ç½®ä¸ºé»˜è®¤è¯¾ç¨‹ä¸»é¢˜å—ï¼Ÿ')) {
                adminTopics = [
                    'æ•°å­¦åŸºç¡€æ¦‚å¿µ',
                    'è¯­æ–‡é˜…è¯»ç†è§£',
                    'è‹±è¯­å£è¯­äº¤æµ',
                    'ç§‘å­¦å®éªŒæ¢ç´¢',
                    'å†å²æ–‡åŒ–ä¼ æ‰¿'
                ];
                log('ğŸ”„ é‡ç½®ä¸ºé»˜è®¤ä¸»é¢˜');
                renderAdminTopics();
                setStatus('å·²é‡ç½®ä¸ºé»˜è®¤ä¸»é¢˜', 'info');
            }
        }

        function handleEnter(event) {
            if (event.key === 'Enter') {
                addTopic();
            }
        }

        // é¡µé¢åŠ è½½æ—¶çš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            log('ğŸ“„ é¡µé¢åŠ è½½å®Œæˆï¼Œè¯·å…ˆç™»å½•');
            log('ğŸ”— APIåœ°å€: ' + API_BASE_URL);
            
            log('ğŸ“„ æ•™å¸ˆç«¯é¡µé¢åˆå§‹åŒ–', 'teacher');
            log('ğŸ”— ç­‰å¾…ç®¡ç†å‘˜ç«¯æ•°æ®åŒæ­¥', 'teacher');
        });
    </script>
</body>
</html>